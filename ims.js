class ImageGenerator{constructor(){this.form=document.getElementById('imageForm'),this.promptInput=document.getElementById('prompt'),this.negativePromptInput=document.getElementById('negativePrompt'),this.sizeSelect=document.getElementById('size'),this.modelSelect=document.getElementById('model'),this.styleSelect=document.getElementById('style'),this.qualitySelect=document.getElementById('quality'),this.imagePreview=document.getElementById('imagePreview'),this.historyList=document.getElementById('historyList'),this.notification=document.getElementById('notification'),this.zoomModal=document.getElementById('zoomModal'),this.zoomedImage=document.getElementById('zoomedImage'),this.init()}async generate(a,b,c,d,e,f){const g='sk-l3OPY1ZMfqG3rJH3HIw90cvmcUxDC8lCva1OQu3GUp60_rgm',h=this.form.querySelector('button');h.disabled=!0,h.innerHTML='Generating... <div class="mini-spinner"></div>';try{const i=await fetch('https://cablyai.com/v1/images/generations',{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${g}`},body:JSON.stringify({prompt:`${'none'!==e?`${e} style: `:''}${a}`,negative_prompt:b,model:d,size:c,quality:f,n:1,response_format:'url'})});if(!i.ok)throw new Error('Generation failed');return(await i.json()).data[0].url}finally{h.disabled=!1,h.textContent='Generate Image üöÄ'}}init(){this.form.addEventListener('submit',async a=>{a.preventDefault(),this.showNotification('',''),this.showLoadingSpinner();const b=this.promptInput.value.trim();if(!b)return this.showNotification('Please enter a description','error');try{const a=await this.generate(b,this.negativePromptInput.value.trim(),this.sizeSelect.value,this.modelSelect.value,this.styleSelect.value,this.qualitySelect.value);this.showImage(a,this.sizeSelect.value),this.saveToHistory({prompt:b,negativePrompt:this.negativePromptInput.value,model:this.modelSelect.value,size:this.sizeSelect.value,style:this.styleSelect.value,quality:this.qualitySelect.value,url:a,timestamp:new Date().toISOString()}),this.showNotification('Image generated successfully!','success')}catch(a){this.showNotification(a.message,'error'),this.imagePreview.innerHTML=''}}),document.querySelector('.theme-toggle').addEventListener('click',()=>{document.documentElement.setAttribute('data-theme','dark'===document.documentElement.getAttribute('data-theme')?'light':'dark')}),document.getElementById('clearHistory').addEventListener('click',a=>{a.preventDefault(),confirm('Clear all generation history?')&&(localStorage.removeItem('imageHistory'),this.historyList.innerHTML='')}),this.zoomModal.addEventListener('click',()=>{this.zoomModal.style.display='none'}),this.loadHistory()}showLoadingSpinner(){this.imagePreview.innerHTML='<div class="loading-spinner"></div>'}showNotification(a,b){this.notification.textContent=a,this.notification.className=`notification ${b}-notification ${a?'visible':''}`,setTimeout(()=>this.notification.classList.remove('visible'),5e3)}showImage(a,b){const[c,d]=b.split('x').map(Number),e=new Image;e.src=a,e.alt='Generated image',e.style.width=`${c}px`,e.style.height=`${d}px`,e.style.maxWidth='100%',e.style.objectFit='contain',e.style.borderRadius='var(--ai-radius)',e.style.cursor='zoom-in',e.addEventListener('click',()=>this.zoomImage(a));const f=document.createElement('button');f.className='success-btn',f.innerHTML='‚¨áÔ∏è Download',f.onclick=()=>this.downloadImage(a);const g=document.createElement('div');g.className='image-actions',g.appendChild(f),this.imagePreview.innerHTML='',this.imagePreview.appendChild(e),this.imagePreview.appendChild(g)}zoomImage(a){this.zoomedImage.src=a,this.zoomModal.style.display='block'}downloadImage(a){const b=document.createElement('a');b.href=a,b.download=`ai-image-${Date.now()}.png`,b.click()}saveToHistory(a){const[b,c]=a.size.split('x').map(Number),d=document.createElement('div');d.className='history-card',d.innerHTML=`<div class="history-meta"><div>${a.model}</div><div>${a.size}</div></div><img src="${a.url}" alt="${a.prompt}" loading="lazy" class="history-image" style="width:${b}px;height:${c}px"><button class="success-btn history-download" title="Download">‚¨áÔ∏è</button><div class="history-prompt">${a.prompt.slice(0,80)}${a.prompt.length>80?'...':''}</div>`,d.querySelector('img').addEventListener('click',()=>this.zoomImage(a.url)),d.querySelector('.history-download').addEventListener('click',a=>{a.stopPropagation(),this.downloadImage(a.target.closest('.history-card').querySelector('img').src)}),this.historyList.prepend(d),this.trimHistory(),this.updateLocalStorage()}updateLocalStorage(){const a=Array.from(this.historyList.children).map(a=>({prompt:a.querySelector('.history-prompt').textContent,model:a.querySelector('.history-meta div:first-child').textContent,size:a.querySelector('.history-meta div:nth-child(2)').textContent,url:a.querySelector('img').src}));localStorage.setItem('imageHistory',JSON.stringify(a))}trimHistory(){const a=Array.from(this.historyList.children);a.length>20&&a.slice(20).forEach(a=>a.remove())}loadHistory(){const a=JSON.parse(localStorage.getItem('imageHistory'))||[];this.historyList.innerHTML=a.map(a=>{const[b,c]=a.size.split('x').map(Number);return`<div class="history-card"><div class="history-meta"><div>${a.model}</div><div>${a.size}</div></div><img src="${a.url}" alt="${a.prompt}" loading="lazy" class="history-image" style="width:${b}px;height:${c}px"><button class="success-btn history-download" title="Download">‚¨áÔ∏è</button><div class="history-prompt">${a.prompt}</div></div>`}).join(''),document.querySelectorAll('.history-card img').forEach(a=>{a.addEventListener('click',()=>this.zoomImage(a.src))}),document.querySelectorAll('.history-download').forEach(a=>{a.addEventListener('click',b=>{b.stopPropagation(),this.downloadImage(b.target.closest('.history-card').querySelector('img').src)})})}}new ImageGenerator;
